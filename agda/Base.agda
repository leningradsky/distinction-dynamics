{-# OPTIONS --safe --without-K #-}

{-
  BASE - Базовые типы и операции
  ===============================
  
  Общие определения для всех модулей DD.
  Не зависит от stdlib.
-}

module Base where

------------------------------------------------------------------------
-- ПУСТОЙ ТИП
------------------------------------------------------------------------

data Void : Set where

absurd : {A : Set} -> Void -> A
absurd ()

------------------------------------------------------------------------
-- ЕДИНИЧНЫЙ ТИП
------------------------------------------------------------------------

record Unit : Set where
  constructor tt

------------------------------------------------------------------------
-- БУЛЕВЫ
------------------------------------------------------------------------

data Bool : Set where
  false : Bool
  true  : Bool

not : Bool -> Bool
not false = true
not true = false

_and_ : Bool -> Bool -> Bool
false and _ = false
true and b = b

_or_ : Bool -> Bool -> Bool
false or b = b
true or _ = true

------------------------------------------------------------------------
-- НАТУРАЛЬНЫЕ ЧИСЛА
------------------------------------------------------------------------

data Nat : Set where
  zero : Nat
  suc  : Nat -> Nat

{-# BUILTIN NATURAL Nat #-}

infixl 6 _+N_
_+N_ : Nat -> Nat -> Nat
zero +N n = n
suc m +N n = suc (m +N n)

infixl 7 _*N_
_*N_ : Nat -> Nat -> Nat
zero *N _ = zero
suc m *N n = n +N (m *N n)

------------------------------------------------------------------------
-- РАВЕНСТВО
------------------------------------------------------------------------

infix 4 _==_
data _==_ {A : Set} (x : A) : A -> Set where
  refl : x == x

sym : {A : Set} {x y : A} -> x == y -> y == x
sym refl = refl

trans : {A : Set} {x y z : A} -> x == y -> y == z -> x == z
trans refl refl = refl

cong : {A B : Set} (f : A -> B) {x y : A} -> x == y -> f x == f y
cong f refl = refl

------------------------------------------------------------------------
-- НЕРАВЕНСТВО
------------------------------------------------------------------------

infix 4 _/=_
_/=_ : {A : Set} -> A -> A -> Set
x /= y = x == y -> Void

------------------------------------------------------------------------
-- СУММА (ИЛИ)
------------------------------------------------------------------------

infixr 1 _+_
data _+_ (A B : Set) : Set where
  inl : A -> A + B
  inr : B -> A + B

either : {A B C : Set} -> (A -> C) -> (B -> C) -> A + B -> C
either f g (inl a) = f a
either f g (inr b) = g b

------------------------------------------------------------------------
-- ПРОИЗВЕДЕНИЕ (И)
------------------------------------------------------------------------

infixr 2 _×_
record _×_ (A B : Set) : Set where
  constructor _,_
  field
    fst : A
    snd : B
open _×_ public

------------------------------------------------------------------------
-- МОЖЕТ БЫТЬ
------------------------------------------------------------------------

data Maybe (A : Set) : Set where
  nothing : Maybe A
  just    : A -> Maybe A

maybe : {A B : Set} -> B -> (A -> B) -> Maybe A -> B
maybe b f nothing = b
maybe b f (just a) = f a

------------------------------------------------------------------------
-- СПИСКИ
------------------------------------------------------------------------

data List (A : Set) : Set where
  []  : List A
  _::_ : A -> List A -> List A

infixr 5 _::_

length : {A : Set} -> List A -> Nat
length [] = zero
length (_ :: xs) = suc (length xs)

_++_ : {A : Set} -> List A -> List A -> List A
[] ++ ys = ys
(x :: xs) ++ ys = x :: (xs ++ ys)

------------------------------------------------------------------------
-- ПОРЯДОК НА NAT
------------------------------------------------------------------------

infix 4 _<=_
data _<=_ : Nat -> Nat -> Set where
  z<=n : {n : Nat} -> zero <= n
  s<=s : {m n : Nat} -> m <= n -> suc m <= suc n

infix 4 _<_
_<_ : Nat -> Nat -> Set
m < n = suc m <= n

_>=_ : Nat -> Nat -> Set
m >= n = n <= m

_>_ : Nat -> Nat -> Set
m > n = n < m

------------------------------------------------------------------------
-- КОНЕЧНЫЕ ТИПЫ
------------------------------------------------------------------------

data Fin : Nat -> Set where
  fzero : {n : Nat} -> Fin (suc n)
  fsuc  : {n : Nat} -> Fin n -> Fin (suc n)

------------------------------------------------------------------------
-- ЗАВИСИМЫЕ ПАРЫ
------------------------------------------------------------------------

record Sigma (A : Set) (B : A -> Set) : Set where
  constructor _,_
  field
    proj1 : A
    proj2 : B proj1
open Sigma public

-- Sigma A B = зависимая пара (a : A, b : B a)

------------------------------------------------------------------------
-- СУЩЕСТВОВАНИЕ
------------------------------------------------------------------------

Exists : {A : Set} -> (A -> Set) -> Set
Exists {A} P = Sigma A P

------------------------------------------------------------------------
-- ОТРИЦАНИЕ
------------------------------------------------------------------------

infix 3 ~_
~_ : Set -> Set
~ A = A -> Void

------------------------------------------------------------------------
-- РЕШАЕМОСТЬ
------------------------------------------------------------------------

data Dec (A : Set) : Set where
  yes : A -> Dec A
  no  : ~ A -> Dec A
