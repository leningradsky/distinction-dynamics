{-# OPTIONS --safe --without-K #-}

{-
  SPIRAL - Спиральная динамика
  =============================
  
  A → AB → ABC → A'
  A' ≠ A, но A' содержит A
  
  Это не цикл, а спираль.
-}

module Spiral where

open import Base

------------------------------------------------------------------------
-- НАКОПЛЕНИЕ
------------------------------------------------------------------------

-- История как последовательность шагов
data History : Set where
  origin : History
  step   : History -> History

-- Глубина
depth : History -> Nat
depth origin = 0
depth (step h) = suc (depth h)

------------------------------------------------------------------------
-- ШАГИ НЕОБРАТИМЫ
------------------------------------------------------------------------

step-injective : {h1 h2 : History} -> step h1 == step h2 -> h1 == h2
step-injective refl = refl

step-not-origin : {h : History} -> step h == origin -> Void
step-not-origin ()

------------------------------------------------------------------------
-- ЗАМЫКАНИЕ
------------------------------------------------------------------------

-- После n шагов можно замкнуться
-- Минимальное n = 3 (триада)

data ClosurePoint : Nat -> Set where
  close : (n : Nat) -> ClosurePoint n

-- Триадическое замыкание
TriadicClosure : Set
TriadicClosure = ClosurePoint 3

------------------------------------------------------------------------
-- СПИРАЛЬ
------------------------------------------------------------------------

-- Спираль = последовательность замыканий
-- Каждое замыкание порождает новое начало

record SpiralStep (A : Set) : Set where
  field
    content : A              -- текущее содержимое
    enriched : A             -- после замыкания
    different : content == enriched -> Void  -- не то же самое

-- Спираль как поток шагов
data Spiral (A : Set) : Nat -> Set where
  start : A -> Spiral A 0
  wind  : {n : Nat} -> Spiral A n -> SpiralStep A -> Spiral A (suc n)

------------------------------------------------------------------------
-- УРОВЕНЬ = ВИТОК СПИРАЛИ
------------------------------------------------------------------------

-- Каждый виток добавляет:
-- 1. Новое содержимое (из предыдущего Exterior)
-- 2. Новое измерение обработки
-- 3. Меньшую асимметрию

-- Уровень n = n витков от начала

------------------------------------------------------------------------
-- РОСТ ЧЕРЕЗ EXTERIOR
------------------------------------------------------------------------

-- Interior стабилен (не меняется)
-- Boundary трансформирует (процесс)
-- Exterior накапливает (материал для следующего)

-- Когда Exterior достаточно богат:
-- -> Новое замыкание
-- -> Exterior становится Interior следующего уровня
-- -> Новый Exterior начинает накапливаться

------------------------------------------------------------------------
-- ВРЕМЯ КАК ПОРЯДОК ШАГОВ
------------------------------------------------------------------------

-- Время = порядок в спирали
-- Не внешний параметр, а структура накопления

-- step h < step (step h)
-- Но не через отношение "<", а через саму структуру

-- Время направлено: нельзя "раскрутить" спираль назад
-- step необратим

------------------------------------------------------------------------
-- ПРОСТРАНСТВО КАК ОДНОВРЕМЕННОСТЬ
------------------------------------------------------------------------

-- На одном витке: несколько элементов "одновременно"
-- Это пространственное измерение

-- Виток n содержит структуру (I, B, E)
-- Все три "одновременны" на витке n
-- Но последовательны в смысле накопления (A → AB → ABC)

------------------------------------------------------------------------
-- 3+1
------------------------------------------------------------------------

-- 3 = структура внутри витка (I, B, E)
-- 1 = переход между витками (время)

-- 3+1 не постулировано, а выведено из спиральной динамики
